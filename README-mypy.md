Ğ”Ğ° ğŸ’¯ â€” Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¸ **Ğ½ÑƒĞ¶Ğ½Ğ¾**!
`mypy` Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ `pyproject.toml`, Ğ¸ ÑÑ‚Ğ¾ ĞºĞ°Ğº Ñ€Ğ°Ğ· ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¸ Ğ°ĞºĞºÑƒÑ€Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¾ÑĞ¾Ğ± â€” Ğ½Ğµ Ğ¿Ğ»Ğ¾Ğ´Ğ¸Ñ‚ÑŒ `.ini`-Ñ„Ğ°Ğ¹Ğ»Ñ‹.

---

## âœ… ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ñ‚Ğ²Ğ¾ĞµĞ³Ğ¾ `pyproject.toml` Ñ ÑĞµĞºÑ†Ğ¸ĞµĞ¹ mypy

Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ² Ğ½ĞµĞ³Ğ¾ Ğ²Ğ¾Ñ‚ Ñ‚Ğ°ĞºÑƒÑ ÑĞµĞºÑ†Ğ¸Ñ:

```toml
[tool.mypy]
python_version = "3.12"

# ğŸ§© ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ğ¹ ĞºĞ¾Ğ´
ignore_missing_imports = true
follow_imports = "silent"
no_site_packages = true

# ğŸš« Ğ¡Ñ‚Ñ€Ğ¾Ğ³Ğ¸Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ´Ğ»Ñ ÑĞ¾Ğ±ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ´Ğ°
disallow_untyped_defs = true
warn_unused_ignores = true
warn_return_any = true
warn_untyped_globals = true

# ğŸ“¦ Ğ•ÑĞ»Ğ¸ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ğ»ĞµĞ¶Ğ¸Ñ‚ Ğ² src/
mypy_path = ["src"]
```

---

## ğŸ’¡ Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚ ĞºĞ°Ğ¶Ğ´Ğ°Ñ Ğ¾Ğ¿Ñ†Ğ¸Ñ

| ĞĞ¿Ñ†Ğ¸Ñ                    | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ   | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ                                             |
| ------------------------ | ---------- | ---------------------------------------------------- |
| `ignore_missing_imports` | `true`     | Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ°ĞºĞµÑ‚Ñ‹ Ğ±ĞµĞ· Ñ‚Ğ¸Ğ¿Ğ¾Ğ² (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, `tinytuya`) |
| `follow_imports`         | `"silent"` | Ğ½Ğµ Ğ¿Ñ‹Ñ‚Ğ°Ñ‚ÑŒÑÑ Ğ»ĞµĞ·Ñ‚ÑŒ Ğ²Ğ½ÑƒÑ‚Ñ€ÑŒ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğ½Ğ¸Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹           |
| `no_site_packages`       | `true`     | Ğ½Ğµ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ğ°ĞºĞµÑ‚Ñ‹                |
| `disallow_untyped_defs`  | `true`     | Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ğ¸Ğ¿Ñ‹ Ñƒ Ğ²ÑĞµÑ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹                        |
| `warn_return_any`        | `true`     | Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´Ğ°Ñ‚ÑŒ, ĞµÑĞ»Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ `Any`         |
| `warn_untyped_globals`   | `true`     | Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´Ğ°Ñ‚ÑŒ Ğ¾ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ±ĞµĞ· Ñ‚Ğ¸Ğ¿Ğ¾Ğ²                 |
| `warn_unused_ignores`    | `true`     | ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ğ»Ğ¸ÑˆĞ½Ğ¸Ğµ `# type: ignore`                    |
| `mypy_path`              | `["src"]`  | Ğ¿ÑƒÑ‚ÑŒ, Ğ³Ğ´Ğµ Ğ¸ÑĞºĞ°Ñ‚ÑŒ Ñ‚Ğ²Ğ¾Ğ¸ Ğ¿Ğ°ĞºĞµÑ‚Ñ‹ (ĞµÑĞ»Ğ¸ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° `src/`) |

---

## ğŸ§ª ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°

Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾:

```bash
uv run mypy
```

Ğ¸Ğ»Ğ¸ (ĞµÑĞ»Ğ¸ Ñƒ Ñ‚ĞµĞ±Ñ Ğ²ÑÑ‘ Ğ² `src/`):

```bash
uv run mypy src/
```

---

## ğŸ§° Ğ¡Ğ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ

* `pyproject.toml` Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ½ĞµĞµ, Ñ‡ĞµĞ¼ `mypy.ini`
* Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ `mypy.ini`
* Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ğ¾ Ğ´Ğ»Ñ `uv`, `poetry`, `pipx`, `venv` Ğ¸ Ñ‚.Ğ¿.

---
ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾, Ñ‚Ñ‹ Ğ¿Ğ¾Ğ¹Ğ¼Ğ°Ğ» ĞµÑ‰Ñ‘ Ğ¾Ğ´Ğ½Ñƒ Ğ¾Ñ‡ĞµĞ½ÑŒ Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ½ÑƒÑ ÑĞ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ñ Ñ **MyPy** ğŸ˜Š
ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ğ¸Ğ´Ğ°

```
Returning Any from function declared to return "int"  [no-any-return]
```

Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµÑ‚, Ñ‡Ñ‚Ğ¾ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ `to_signed()` ĞºĞ°ĞºĞ°Ñ-Ñ‚Ğ¾ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ **Ñ‚Ğ¸Ğ¿ `Any`**, Ğ¸ MyPy **Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ´Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ**, Ñ‡Ñ‚Ğ¾ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ `int`.

---

```bashs
rc/difonlib/utils.py:84: error: Returning Any from function declared to return "int" [no-any-return] src/difonlib/utils.py:86: error: Returning Any from function declared to return "int" [no-any-return]
```

## ğŸ” ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚

Ğ¢Ğ²Ğ¾Ğ¹ ĞºĞ¾Ğ´:

```python
def to_signed(number: int, bits: int = 32) -> int:
    mask = (2**bits) - 1
    if number & (1 << (bits - 1)):
        return number | ~mask
    else:
        return number & mask
```

Ğ¡ Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ·Ñ€ĞµĞ½Ğ¸Ñ Python â€” Ğ²ÑÑ‘ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾.
ĞĞ¾ MyPy **Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚**, Ñ‡Ñ‚Ğ¾ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¿Ğ¾Ğ±Ğ¸Ñ‚Ğ¾Ğ²Ñ‹Ñ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹ `|`, `&`, `~` Ğ½Ğ°Ğ´ `int` Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¾ÑÑ‚Ğ°Ñ‘Ñ‚ÑÑ `int`.
ĞĞ½ Ğ¸Ğ½Ğ¾Ğ³Ğ´Ğ° Ğ²Ğ¾ÑĞ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ Ğ¸Ñ… ĞºĞ°Ğº `Any`, Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ ĞµÑĞ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ³Ğ´Ğµ-Ñ‚Ğ¾ Ğ¿Ğ¾Ñ‚ĞµÑ€ÑĞ»Ğ° Ñ‚Ğ¸Ğ¿.

---

## âœ… ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ

Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ **ÑĞ²Ğ½Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹** Ğº Ğ¿Ñ€Ğ¾Ğ¼ĞµĞ¶ÑƒÑ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¼ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸ÑĞ¼:

```python
def to_signed(number: int, bits: int = 32) -> int:
    mask: int = (2**bits) - 1
    if number & (1 << (bits - 1)):
        result: int = number | ~mask
    else:
        result: int = number & mask
    return result
```

âœ… MyPy Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ·Ğ½Ğ°ĞµÑ‚, Ñ‡Ñ‚Ğ¾ Ğ²ÑÑ‘ â€” `int`.

---

## ğŸ’¡ ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ°: Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· `typing.cast`

```python
from typing import cast

def to_signed(number: int, bits: int = 32) -> int:
    mask = (2**bits) - 1
    if number & (1 << (bits - 1)):
        return cast(int, number | ~mask)
    else:
        return cast(int, number & mask)
```

> `cast(int, ...)` â€” Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ MyPy: *Ğ¿Ğ¾Ğ²ĞµÑ€ÑŒ Ğ¼Ğ½Ğµ, ÑÑ‚Ğ¾ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ int.*

---

## ğŸ§© ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ MyPy

* `Pyright` (Ğ² Emacs, VSCode) Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ **Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚** Ğ¿Ğ¾Ğ±Ğ¸Ñ‚Ğ¾Ğ²Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ â€” Ğ¾Ğ½ ÑƒĞ¼ĞµĞµÑ‚ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ¸Ñ‚ÑŒ Ñ‚Ğ¸Ğ¿Ñ‹ Ğ³Ğ»ÑƒĞ±Ğ¶Ğµ.
* `MyPy` Ğ³Ğ¾Ñ€Ğ°Ğ·Ğ´Ğ¾ ĞºĞ¾Ğ½ÑĞµÑ€Ğ²Ğ°Ñ‚Ğ¸Ğ²Ğ½ĞµĞµ: ĞµÑĞ»Ğ¸ Ğ³Ğ´Ğµ-Ñ‚Ğ¾ Ñ‚Ğ¸Ğ¿ Ğ½Ğµ 100 % Ğ¸Ğ·Ğ²ĞµÑÑ‚ĞµĞ½, Ğ¾Ğ½ Ğ¿Ğ¾Ğ´ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ `Any` Ğ¸ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚ Ñ€ÑƒĞ³Ğ°Ñ‚ÑŒÑÑ Ğ½Ğ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ.

---

## ğŸ§° ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ (ĞµÑĞ»Ğ¸ Ğ½Ğµ Ñ…Ğ¾Ñ‡ĞµÑˆÑŒ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ)

Ğ•ÑĞ»Ğ¸ Ñ…Ğ¾Ñ‡ĞµÑˆÑŒ Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ´ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ, Ğ¼Ğ¾Ğ¶ĞµÑˆÑŒ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ Ğ¾ÑĞ»Ğ°Ğ±Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ¾:

```toml
[tool.mypy]
warn_return_any = false
```

Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ:

```python
def to_signed(number: int, bits: int = 32) -> int:
    mask = (2**bits) - 1
    if number & (1 << (bits - 1)):
        return number | ~mask  # type: ignore[no-any-return]
    else:
        return number & mask   # type: ignore[no-any-return]
```

ĞĞ¾ ÑÑ‚Ğ¾ ÑƒĞ¶Ğµ Ğ¾Ğ±Ñ…Ğ¾Ğ´, Ğ½Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ.
Ğ›ÑƒÑ‡ÑˆĞµ Ğ²ÑÑ‘-Ñ‚Ğ°ĞºĞ¸ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ Ñ `cast` Ğ¸Ğ»Ğ¸ ÑĞ²Ğ½Ñ‹Ğ¼ `int(...)`.

---

Ğ¥Ğ¾Ñ‡ĞµÑˆÑŒ, Ñ Ğ¿Ğ¾ĞºĞ°Ğ¶Ñƒ Â«Ğ¸Ğ´ĞµĞ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹Â» Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ `to_signed()` â€” Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ñ‚Ğ¸Ğ¿Ğ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹ Ğ¸ Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ñ‹Ğ¹, Ñ Ğ¿Ğ¾ÑÑĞ½ĞµĞ½Ğ¸ĞµĞ¼ ĞºĞ°Ğº Ğ¾Ğ½ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚?
